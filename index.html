<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Upload file (Roblox-only download)</title>
    <style>
      body { font-family: system-ui, Arial; max-width: 720px; margin: 40px auto; }
      .ok { color: green }
      .err { color: red }
    </style>
  </head>
  <body>
    <h1>Upload a file</h1>
    <p>Files are stored on the server and are not directly readable by a browser. The server returns a file ID which your Roblox game can use to download the file by sending the Roblox token in the <code>X-Roblox-Token</code> header.</p>

    <form id="uploadForm">
      <input id="fileInput" type="file" name="file" required />
      <br/><br/>
      <button type="submit">Upload</button>
    </form>

    <div id="result" aria-live="polite"></div>

    <script>
      const form = document.getElementById('uploadForm');
      const result = document.getElementById('result');

      form.addEventListener('submit', async (evt) => {
        evt.preventDefault();
        result.textContent = 'Uploading...';
        const fileInput = document.getElementById('fileInput');
        if (!fileInput.files || fileInput.files.length === 0) {
          result.innerHTML = '<span class="err">No file selected.</span>';
          return;
        }
        const file = fileInput.files[0];
        const fd = new FormData();
        fd.append('file', file);

        try {
          const res = await fetch('/upload', {
            method: 'POST',
            body: fd
          });
          if (!res.ok) {
            const txt = await res.text();
            result.innerHTML = '<span class="err">Upload failed: ' + txt + '</span>';
            return;
          }
          const j = await res.json();
          // The download URL requires the ROBLOX token header and cannot be opened directly in a browser.
          result.innerHTML = '<div class="ok">Uploaded successfully.</div>'
            + '<p>File ID: <code>' + j.id + '</code></p>'
            + '<p>Download endpoint: <code>' + j.downloadUrl + '</code></p>'
            + '<p><em>Important:</em> You must include the Roblox token in header <code>X-Roblox-Token</code> when downloading (Roblox game should set it).</p>';
        } catch (err) {
          console.error(err);
          result.innerHTML = '<span class="err">Upload error: ' + String(err) + '</span>';
        }
      });
    </script>
  </body>
</html>
